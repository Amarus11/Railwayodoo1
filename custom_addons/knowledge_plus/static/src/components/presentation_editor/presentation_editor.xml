<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="knowledge_plus.PresentationEditor">
        <div class="o_presentation_editor d-flex h-100">
            <!-- Preview mode: full RevealJS -->
            <div t-if="state.previewMode" class="o_presentation_preview w-100 h-100 position-relative">
                <div class="o_presentation_preview_toolbar d-flex align-items-center gap-2 p-2 border-bottom bg-white position-absolute top-0 start-0 end-0" style="z-index: 10;">
                    <button class="btn btn-sm btn-outline-secondary" t-on-click="togglePreview">
                        <i class="fa fa-arrow-left me-1"/>Exit Preview
                    </button>
                    <span class="text-muted small">
                        Use arrow keys or click to navigate
                    </span>
                </div>
                <div t-ref="previewContainer" class="w-100 h-100" style="padding-top: 42px;"/>
            </div>

            <!-- Edit mode: slide list + editor -->
            <t t-else="">
                <!-- Slide list panel -->
                <div class="o_slide_list_panel border-end bg-100 d-flex flex-column" style="width: 220px; min-width: 220px;">
                    <div class="d-flex align-items-center justify-content-between p-2 border-bottom">
                        <span class="fw-bold small text-muted">SLIDES</span>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-link p-0" t-on-click="addSlide" title="Add slide">
                                <i class="fa fa-plus"/>
                            </button>
                        </div>
                    </div>
                    <div class="flex-grow-1 overflow-auto">
                        <t t-foreach="state.slides" t-as="slide" t-key="slide.id">
                            <div t-attf-class="o_slide_thumb d-flex align-items-center gap-2 px-2 py-2 cursor-pointer border-bottom #{state.activeSlideIndex === slide_index ? 'active' : ''}"
                                 t-on-click="() => this.selectSlide(slide_index)">
                                <span class="o_slide_number badge bg-secondary rounded-pill">
                                    <t t-out="slide_index + 1"/>
                                </span>
                                <span class="o_slide_label text-truncate small">
                                    <t t-out="getSlideLabel(slide, slide_index)"/>
                                </span>
                            </div>
                        </t>
                    </div>
                </div>

                <!-- Main editor area -->
                <div class="o_slide_editor_main flex-grow-1 d-flex flex-column">
                    <!-- Toolbar -->
                    <div class="o_slide_toolbar d-flex align-items-center gap-2 p-2 border-bottom bg-white flex-wrap">
                        <button class="btn btn-sm btn-primary" t-on-click="togglePreview">
                            <i class="fa fa-play me-1"/>Preview
                        </button>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-secondary" t-on-click="moveSlideUp"
                                    t-att-disabled="state.activeSlideIndex === 0" title="Move up">
                                <i class="fa fa-arrow-up"/>
                            </button>
                            <button class="btn btn-outline-secondary" t-on-click="moveSlideDown"
                                    t-att-disabled="state.activeSlideIndex >= state.slides.length - 1" title="Move down">
                                <i class="fa fa-arrow-down"/>
                            </button>
                        </div>
                        <button class="btn btn-sm btn-outline-secondary" t-on-click="duplicateSlide" title="Duplicate slide">
                            <i class="fa fa-copy me-1"/>Duplicate
                        </button>
                        <button class="btn btn-sm btn-outline-danger" t-on-click="deleteSlide"
                                t-att-disabled="state.slides.length &lt;= 1" title="Delete slide">
                            <i class="fa fa-trash"/>
                        </button>
                        <span class="ms-auto text-muted small">
                            Slide <t t-out="state.activeSlideIndex + 1"/> of <t t-out="state.slides.length"/>
                        </span>
                    </div>

                    <!-- Slide content editor -->
                    <div class="flex-grow-1 d-flex flex-column p-3 overflow-auto">
                        <div class="o_slide_preview_box border rounded bg-white mx-auto mb-3 shadow-sm"
                             style="width: 100%; max-width: 800px; aspect-ratio: 16/9; overflow: hidden;">
                            <div class="p-4 h-100 d-flex flex-column justify-content-center align-items-center"
                                 style="font-size: 1.1em;">
                                <t t-if="activeSlide" t-out="activeSlide.content"/>
                            </div>
                        </div>
                        <div class="mx-auto" style="width: 100%; max-width: 800px;">
                            <label class="form-label small text-muted">HTML Content:</label>
                            <textarea class="form-control font-monospace"
                                      rows="8"
                                      t-att-value="state.editingContent"
                                      t-on-input="onContentInput"
                                      t-att-readonly="props.readonly"
                                      placeholder="Enter slide HTML content..."/>
                        </div>
                    </div>
                </div>
            </t>
        </div>
    </t>
</templates>
